<html>
    <style>
        body {background-color: powderblue;}
        h1{
            color: blue;
        }
        p{
            color:red;
        }
        button{
            height:50px; 
            width:100px; 
        }
        div{
            text-align:center;
        }
    </style>
    <head>
        <script src="node_modules/jquery/dist/jquery.min.js"></script>
        <title>Home Page</title>
    </head>
    <body>
        <a href=index.html><button id="back">Back</button></a>
        
        <div id = "main_body">
            <h1>Please Login to your Account</h1>
            <label for="login_email">Please Enter Your Email:</label>
            <input type="text" id="login_email"><br><br>
            <label for="login_pwd">Please Enter Your Password:</label>
            <input type="password" id="login_pwd"><br><br>
            <button id="submit" onclick="login()">Submit</button>
            <p id="login_warning" style="display:none">Email or password is not valid, please re-enter</p> 
        </div>
        
    </body>

    <script>
        function login() {
            document.getElementById("login_warning").style.display='none'
            var uEmail = document.getElementById("login_email").value;
            var uPwd = document.getElementById("login_pwd").value;
            if (uEmail === "" || uPwd === "") {
                loginError();
                return;
            }
            // make an ajax post
            $.ajax({
                type: "POST",
                url: "/login",
                dataType: "json",
                data: JSON.stringify({ "uEmail": uEmail, "uPassword": uPwd }),
                success: this.loginResponse,
                error: this.loginError
            });
        }

        function loginResponse(data) {
            if (data.mStatus === "ok") {
                if (typeof(Storage) !== "undefined") {
                    localStorage.uEmail = document.getElementById("login_email").value;
                    localStorage.uPwd = document.getElementById("login_pwd").value;
                    localStorage.sessionKey = data.mData.sessionKey;
                    localStorage.uId = data.mData.uId;
                } else {
                    console.log("Your browser doesn't support web storage...");
                    return;
                }
                // TODO: go to logged in page
                window.location.href = "/loggedin.html";
            } else if (data.mStatus === "error") {
                loginError();
                console.log("The server replied with an error:\n" + data.mpwd);
            } else {
                loginError();
                console.log("Unknown internal error");
            }
        }

        function loginError() {
            document.getElementById("login_warning").style.display = 'block';
            document.getElementById("login_email").value = "";
            document.getElementById("login_pwd").value = "";
        }
    </script>
</html>